- hosts: localhost
  tags:
    - always
  tasks:
    - name: "Add target host to ansible memory"
      add_host:
        name: "{{ ip }}"
        groups: myhost
        ansible_user: "{{ user_name }}"
    - name: "Install necessary galaxy roles"
      local_action: command ansible-galaxy install -r requirements.yml

# Virtualbox not here because it requires manual interaction
# Dropbox, evernote were removed due to user limit
#- hosts: 127.0.0.1
#  connection: local
- hosts: all
  vars:
    cli_packages: ['git',
                   'zsh',
                   'ansible',
                   'azure-cli',
                   'awscli','aws-vault',
                   'curl',
                   'packer',
                   'terraform-docs', 'terraform_landscape', 'warrensbox/tap/tfswitch',
                   'kops', 'kubernetes-cli', 'kubernetes-helm', 'kubectl', 'k9s',
                   'go',
                   'minikube', 'kind',
                   'wget',
                   'openssl',
                   'ag',
                   'kubectx', 'kube-ps1',
                   'jq', 'yq',
                   'podman', 'colima']
    app_packages: ['1password',
                   'caffeine',
                   'remote-desktop-manager-free',
                   'macdown',
                   'slack',
                   'spotify',
                   'visual-studio-code',
                   'firefox',
                   #'docker',
                   'podman-desktop',
                   'notion',
                   'vagrant',
                   'mongodb-compass', 'homebrew/cask-versions/sequel-pro-nightly',
                   'iterm2']
  tasks:
    - name: "Import Base"
      import_role:
        name: base
      tags: ['packages']

    - name: "Import Shell"
      import_role:
        name: shell
      tags: ['shell']

#    - name: "Install pyenv"
#      import_role:
#        name: pyenv
#      tags: ['pyenv']

#    - name: "Import Java"
#      import_role:
#        name: java
#      tags: ['java']

#    - name: "Import NodeJS"
#      import_role:
#        name: nodejs
#      tags: ['nodejs']

    - name: "Import SSH"
      import_role:
        name: ssh
      tags: ['ssh']

    - name: "Import Git"
      import_role:
        name: git
      tags: ['git']

    - name: "Import VIM"
      import_role:
        name: vim
      tags: ['vim']
